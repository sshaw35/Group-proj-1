<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Star Wars Universe Lookup</title>

  <!-- Orbitron font (sci-fi inspired, from Google Fonts) -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">

  <style>

    body {
      font-family: 'Orbitron', sans-serif;
      margin: 20px;  
      background-color: #000; 
    }

    h1 {
      margin-bottom: 1rem;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      color: yellow;
      font-weight: bold;
    }

    .section {
      border: 1px solid #555;
      margin-bottom: 15px;
      border-radius: 5px;
      background-color: #111;
    }

    .section-header {
      background-color: #000;
      padding: 12px;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      text-align: center;
      font-family: 'Orbitron', sans-serif;
      color: yellow;
      border-bottom: 1px solid #555;
    }

    .section-body {
      display: none;
      padding: 10px;
    }

    .search-box {
      margin-bottom: 10px;
    }

    .clickable {
      display: flex;
      align-items: center;
      cursor: pointer;
      padding: 12px;
      border-bottom: 1px solid #333;
      transition: background-color 0.2s;
      color: yellow;
      font-size: 1.1rem; /* larger text */
    }
    .clickable:hover {
      background-color: #222;
    }
    input[type="text"] {
      width: 100%;
      padding: 6px;
      font-size: 1em;
      box-sizing: border-box;
      border: 1px solid #666;
      border-radius: 4px;
      background-color: #222;
      color: #fff;
    }
  </style>
</head>

<body>
  <h1>Star Wars Universe Lookup</h1>

  <div class="section" id="charactersSection">
    <div class="section-header">Characters</div>
    <div class="section-body">
      <input type="text" id="characterSearch" class="search-box" placeholder="Search characters..." />
      <div id="charactersContainer"></div>
    </div>
  </div>

  <div class="section" id="speciesSection">
    <div class="section-header">Species</div>
    <div class="section-body">
      <input type="text" id="speciesSearch" class="search-box" placeholder="Search species..." />
      <div id="speciesContainer"></div>
    </div>
  </div>

  <script>
    const charactersSection = document.querySelector('#charactersSection');
    const speciesSection = document.querySelector('#speciesSection');
    const characterHeader = charactersSection.querySelector('.section-header');
    const speciesHeader = speciesSection.querySelector('.section-header');
    const characterBody = charactersSection.querySelector('.section-body');
    const speciesBody = speciesSection.querySelector('.section-body');

    const charactersContainer = document.getElementById('charactersContainer');
    const speciesContainer = document.getElementById('speciesContainer');
    const characterSearch = document.getElementById('characterSearch');
    const speciesSearch = document.getElementById('speciesSearch');

    let characters = [];
    let speciesList = [];

    let charactersLoaded = false;
    let speciesLoaded = false;

    characterHeader.addEventListener('click', async () => {
      toggleSection(characterBody);
      if (!charactersLoaded) {
        await getCharacters();
        charactersLoaded = true;
      }
    });

    speciesHeader.addEventListener('click', async () => {
      toggleSection(speciesBody);
      if (!speciesLoaded) {
        await getSpecies();
        speciesLoaded = true;
      }
    });

    characterSearch.addEventListener('input', () => {
      const query = characterSearch.value.trim();
      const filtered = filterList(characters, query);
      renderList(filtered, charactersContainer, 'character');
    });

    speciesSearch.addEventListener('input', () => {
      const query = speciesSearch.value.trim();
      const filtered = filterList(speciesList, query);
      renderList(filtered, speciesContainer, 'species');
    });

    function toggleSection(section) {
      section.style.display = section.style.display === 'block' ? 'none' : 'block';
    }

    function filterList(list, query) {
      try {
        const re = new RegExp(query, 'i');
        return list.filter(item => re.test(item.name));
      } catch {
        return list; // fallback if invalid regex
      }
    }

    async function getCharacters() {
      try {
        const res = await fetch('http://localhost:9001/api/characters');
        if (!res.ok) throw new Error('Failed to fetch characters');
        characters = await res.json();
        renderList(characters, charactersContainer, 'character');
      } catch (err) {
        charactersContainer.innerHTML = `<p>Error loading characters: ${err.message}</p>`;
      }
    }

    async function getSpecies() {
      try {
        const res = await fetch('http://localhost:9001/api/species');
        if (!res.ok) throw new Error('Failed to fetch species');
        speciesList = await res.json();
        renderList(speciesList, speciesContainer, 'species');
      } catch (err) {
        speciesContainer.innerHTML = `<p>Error loading species: ${err.message}</p>`;
      }
    }

    function renderList(list, container, type) {
      container.replaceChildren();
      list.forEach(item => {
        const el = document.createElement('div');
        el.textContent = item.name;
        el.classList.add('clickable');
        el.addEventListener('click', () => {
          const url = type === 'character'
            ? `/character.html?id=${item.id}`
            : `/species.html?id=${item.id}`;
          window.location.href = url;
        });
        container.appendChild(el);
      });
    }
  </script>
</body>

</html>

