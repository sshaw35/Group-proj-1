<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Star Wars Universe Lookup</title>

  <!-- Orbitron font (sci-fi inspired, from Google Fonts) -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">

  <style>
    /* Body Style: Black background, 20px margin */
    body {
      font-family: 'Orbitron', sans-serif;
      margin: 20px;
      background-color: #000;
    }

    /* Header Style: Yellow, centered, bold */
    h1 {
      text-align: center;
      color: yellow;
      font-weight: bold;
    }

    /* Section container with yellow glow */
    .section {
      box-shadow: 0 0 15px yellow;
      background-color: #111;
    }

    /* Clickable header style */
    .section-header {
      background-color: #000;
      padding: 12px;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      color: yellow;
      text-align: center;
      border-bottom: 1px solid #555;
    }

    /* Collapsible section content */
    .section-body {
      display: none;
      padding: 10px;
    }

    /* Clickable items in lists */
    .clickable {
      cursor: pointer;
      padding: 12px;
      border-bottom: 1px solid #333;
      transition: background-color 0.2s;
      color: yellow;
      font-size: 1.1rem;
    }

    .clickable:hover {
      background-color: #222;
    }

    /* Search input style */
    input[type="text"] {
      width: 100%;
      padding: 6px;
      font-size: 1em;
      font-family: 'Orbitron', sans-serif;
      box-sizing: border-box;
      border: 1px solid #666;
      border-radius: 4px;
      background-color: #222;
      color: yellow;
    }
  </style>
</head>

<body>
  <h1>Star Wars Universe Lookup</h1>

  <div class="section" id="charactersSection">
    <div class="section-header">Characters</div>
    <div class="section-body">
      <input type="text" id="characterSearch" placeholder="Search characters..." />
      <div id="charactersContainer"></div>
    </div>
  </div>

  <div class="section" id="speciesSection">
    <div class="section-header">Species</div>
    <div class="section-body">
      <input type="text" id="speciesSearch" placeholder="Search species..." />
      <div id="speciesContainer"></div>
    </div>
  </div>

  <script>
    // DOM references
    const characterHeader = document.querySelector('#charactersSection .section-header');
    const speciesHeader = document.querySelector('#speciesSection .section-header');
    const characterBody = document.querySelector('#charactersSection .section-body');
    const speciesBody = document.querySelector('#speciesSection .section-body');

    const charactersContainer = document.getElementById('charactersContainer');
    const speciesContainer = document.getElementById('speciesContainer');
    const characterSearch = document.getElementById('characterSearch');
    const speciesSearch = document.getElementById('speciesSearch');

    // Data storage
    let characters = [];
    let speciesList = [];

    // Load flags
    let charactersLoaded = false;
    let speciesLoaded = false;

    // Toggle visibility of sections and load data on first open
    characterHeader.addEventListener('click', async () => {
      toggleSection(characterBody);
      if (!charactersLoaded) {
        await getCharacters();
        charactersLoaded = true;
      }
    });

    speciesHeader.addEventListener('click', async () => {
      toggleSection(speciesBody);
      if (!speciesLoaded) {
        await getSpecies();
        speciesLoaded = true;
      }
    });

    // Search filters
    characterSearch.addEventListener('input', () => {
      const query = characterSearch.value.trim();
      const filtered = filterList(characters, query);
      renderList(filtered, charactersContainer, 'character');
    });

    speciesSearch.addEventListener('input', () => {
      const query = speciesSearch.value.trim();
      const filtered = filterList(speciesList, query);
      renderList(filtered, speciesContainer, 'species');
    });

    // Toggle section visibility helper
    function toggleSection(section) {
      section.style.display = section.style.display === 'block' ? 'none' : 'block';
    }

    // Filter list by name with case-insensitive regex
    function filterList(list, query) {
      try {
        const re = new RegExp(query, 'i');
        return list.filter(item => re.test(item.name));
      } catch {
        return list;
      }
    }

    // Fetch characters from API and render
    async function getCharacters() {
      try {
        const res = await fetch('http://localhost:9001/api/characters');
        if (!res.ok) throw new Error('Failed to fetch characters');
        characters = await res.json();
        renderList(characters, charactersContainer, 'character');
      } catch (err) {
        charactersContainer.innerHTML = `<p style="color:red;">Error loading characters: ${err.message}</p>`;
      }
    }

    // Fetch species from API and render
    async function getSpecies() {
      try {
        const res = await fetch('http://localhost:9001/api/species');
        if (!res.ok) throw new Error('Failed to fetch species');
        speciesList = await res.json();
        renderList(speciesList, speciesContainer, 'species');
      } catch (err) {
        speciesContainer.innerHTML = `<p style="color:red;">Error loading species: ${err.message}</p>`;
      }
    }

    // Render clickable list items that navigate on click
    function renderList(list, container, type) {
      container.replaceChildren();
      list.forEach(item => {
        const el = document.createElement('div');
        el.textContent = item.name;
        el.classList.add('clickable');
        el.addEventListener('click', () => {
          const url = type === 'character'
            ? `/character.html?id=${item.id}`
            : `/species.html?id=${item.id}`;
          window.location.href = url;
        });
        container.appendChild(el);
      });
    }
  </script>
</body>

</html>

